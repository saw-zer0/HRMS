<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance</title>
    <link rel="stylesheet" href="attendance_copy.css">
    <script src="https://kit.fontawesome.com/b99e675b6e.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

</head>
<body>

<div class="wrapper">
  <div class="sidebar">
    <h2><img src="/LOGO.png" class="logo"></h2>
    <ul>
      <li class="home"><a href="#" class="nav-item">Home</a></li>
      <li class="profile"><a href="#" class="nav-item">Profile</a></li>
      <li class="attendance"><a href="#" class="nav-item">Attendance</a></li>
      <li class="leave"><a href="#" class="nav-item">Leave</a></li>
      <li class="payroll"><a href="#" class="nav-item">Payroll</a></li>
    </ul>
    <div class="social_media">
    </div>
  </div>
  <div class="main_content">
    <div class="header">
      <div class="notification">
        <button class="notify-btn"><i class="fas fa-bell"></i></button>
        <div class="dropdown-content" id="dropdownContent">
          <!-- Dummy notifications -->
          <a href="#">New leave request from John Doe</a>
          <a href="#">Reminder: Performance review due for Jane Smith</a>
          <a href="#">Upcoming birthday: Happy Birthday to Sarah Johnson!</a>
        </div>
      </div>
      
      <div class="profile">
        <button class="profile-button" onclick=""> <i class="fas fa-user"></i><span>AnupThapa</span></button>
      </div>
      <div class="popup" id="popup">
        <span class="popup-content">
          
          <span class="close" id="close">&times;</span>
           <div class="image-container">
            <img src="profile.png" alt="Image" class="popup-image">
           </div> 
           <span class="edit-profile">
            <a href="#" id="edit-profile-link">Edit Profile</a>
          </span>
          <p class="name">Anup Thapa</p>
          <p>Email: anup@example.com</p>
          <p>Address: kamalpokhari</p>
          <p>Phone number: 98000000</p>
        
        </span>
      </div>
      
      <section><button class="logout">Logout</button>
        <span class="overlay"></span>
  
        <div class="modal-box">
          <h2>Logout</h2>
          <h3>Are you sure you want to log out?</h3>
  
          <div class="buttons">
            <button class="close-btn">Cancel</button>
            <button class="confirm-btn">Logout</button>
          </div>
        </div></section>
      
    </div>

    <div class="attendance-content">
        <div class="attendance-header">
          <h2>Attendance</h2>
          <div class="attendance-record">
            <h3>Attendance Record for Current Month</h3>
            <div class="record-boxes">
              <div class="box">
                <h4>Absent Days</h4>
                <p>5</p>
              </div>
              <div class="box">
                <h4>Present Days</h4>
                <p>25</p>
              </div>
              <div class="box">
                <h4>Overtime Days</h4>
                <p>3</p>
              </div>
            </div>
          </div>
        </div>
        <div class="clock-buttons">
          <button class="clock-in-btn" id="clock-in-button">Clock In</button>
          <button class="clock-out-btn" id="clock-out-button">Clock Out</button>
        </div>
        
        <div class="time-sheet">
          <h3>Attendance Time Sheet</h3>
          <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Clock In Time</th>
                    <th>Clock Out Time</th>
                    <th>Apply for Correction</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>2024-04-01</td>
                    <td>08:00 AM</td>
                    <td>05:00 PM</td>
                    <td><button class="apply-correction-btn"><img src="image/Group 56.png"></button></td>
                </tr>
            
            </tbody>
        </table>
        </div>
      </div>
      <div class="correction-popup" id="correction-popup">
        <span class="popup-content">
          <span class="close" id="close-correction">&times;</span>
          <h3>Apply for Correction</h3>
          <form id="correction-form">
            <label for="employee-name" class="small-label">Employee Name:</label>
            <input type="text" id="employee-name" name="employee-name" class="small-input" required><br><br>            
            
              <label for="joinedDate">Date:</label>
              <input type="date" id="date" name="joinedDate" required> <br><br>
          
            <label for="reason">Reason:</label>
            <textarea id="reason" name="reason" required></textarea><br><br>
            
            <div class="button-container">
              <button type="button" id="cancel-correction">Cancel</button>
              <button type="submit">Submit</button>
            </div>
          </form>
        </span>
      </div>

      <script>
        //profile popup
        document.addEventListener("DOMContentLoaded", function() {
          var profileButton = document.querySelector(".profile-button");
          var popup = document.querySelector(".popup");
          var closePopup = document.querySelector(".close");
        
          profileButton.addEventListener("click", function() {
            popup.style.display = "block";
          });
        
          closePopup.addEventListener("click", function() {
            popup.style.display = "none";
          });
        });
      //apply correction popup
    document.addEventListener("DOMContentLoaded", function() {
    var applyCorrectionButtons = document.querySelectorAll(".apply-correction-btn");
    var correctionPopup = document.getElementById("correction-popup");
    var closeCorrection = document.getElementById("close-correction");
    var cancelCorrection = document.getElementById("cancel-correction");

    
    applyCorrectionButtons.forEach(function(button) {
      button.addEventListener("click", function() {
        
        var date = this.parentNode.parentNode.firstElementChild.innerText;
        document.getElementById("date").value = date;
        
        correctionPopup.style.display = "block";
      });
    });

    
    closeCorrection.addEventListener("click", function() {
      correctionPopup.style.display = "none";
    });

    
    cancelCorrection.addEventListener("click", function() {
      correctionPopup.style.display = "none";
    });

   
    document.getElementById("correction-form").addEventListener("submit", function(event) {
      event.preventDefault(); 

      var employeeName = document.getElementById("employee-name").value;
      var date = document.getElementById("date").value;
      var reason = document.getElementById("reason").value;

      correctionPopup.style.display = "none";
    });
  });
  //clockin button
  document.getElementById("clock-in-button").addEventListener("click", async () => {
    try {
        
        const response = await fetch("/attendance/clock-in", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({})  
        });
        if (!response.ok) {
            throw new Error("Failed to clock in");
        }
        console.log("Clock-in successful");
    } catch (error) {
        console.error("Error:", error.message);
    }
});

//clockout button
document.getElementById("clock-out-button").addEventListener("click", async () => {
    try {
        
        const response = await fetch("/attendance/clock-out", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({})  
        });
        if (!response.ok) {
            throw new Error("Failed to clock out");
        }
        console.log("Clock-out successful");
    } catch (error) {
        console.error("Error:", error.message);
    }
});
//fetch clock-in data from databse
fetch("/attendance")
    .then(response => response.json())
    .then(data => {
      
        const tableBody = document.querySelector(".time-sheet table tbody");
        data.forEach(entry => {
            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${entry.date}</td>
                <td>${entry.clock_in}</td>
                <td>${entry.clock_out}</td>
                <td><button class="apply-correction-btn">Apply</button></td>
            `;
            tableBody.appendChild(row);
        });
    })
    .catch(error => console.error("Error fetching attendance data:", error));


   // Get the bell button and dropdown content
var bellButton = document.querySelector('.notify-btn');
var dropdownContent = document.getElementById('dropdownContent');

// Toggle dropdown visibility on bell button click
bellButton.addEventListener('click', function(event) {
  // Prevent default action of button click
  event.preventDefault();
  
  // Toggle the visibility of the dropdown content
  dropdownContent.classList.toggle('show');
  
  // Get the position of the bell button
  var buttonRect = bellButton.getBoundingClientRect();
  
  // Set the position of the dropdown content relative to the bell button
  dropdownContent.style.top = (buttonRect.bottom + window.pageYOffset) + 'px';
  dropdownContent.style.left = buttonRect.left + 'px';
});

// Close the dropdown if the user clicks outside of it
window.addEventListener('click', function(event) {
  if (!event.target.matches('.notify-btn')) {
    dropdownContent.classList.remove('show');
  }
});



    //fetch clock-out data from database
    // fetch("/attendance")
    // .then(response => response.json())
    // .then(data => {
      
    //     const tableBody = document.querySelector(".time-sheet table tbody");
    //     data.forEach(entry => {
    //         const row = document.createElement("tr");
    //         row.innerHTML = `
    //             <td>${entry.date}</td>
    //             <td>${entry.clock_in}</td>
    //             <td>${entry.clock_out}</td>
    //             <td><button class="apply-correction-btn">Apply</button></td>
    //         `;
    //         tableBody.appendChild(row);
    //     });
    // })
    // .catch(error => console.error("Error fetching attendance data:", error));

    //logout button
const section = document.querySelector("section"),
overlay = document.querySelector(".overlay"),
showBtn = document.querySelector(".logout"),
closeBtn = document.querySelector(".close-btn");

//showBtn.addEventListener("click", () => section.classList.add("active"));
showBtn.addEventListener("click", () => {
if (section) {
    section.classList.add("active");
} else {
    console.error("Main content element not found!");
}
});

overlay.addEventListener("click", () =>
section.classList.remove("active")
);

closeBtn.addEventListener("click", () =>
section.classList.remove("active")
);

      </script>
</body>
</html>
